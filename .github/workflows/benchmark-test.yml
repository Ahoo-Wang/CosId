name: Benchmark Test
on: [ push ]
jobs:
  cosid-shardingsphere-benchmark:
    name: CosId ShardingSphere Benchmark
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: Set up JDK 8
        uses: actions/setup-java@v2
        with:
          java-version: '8'
          distribution: 'adopt'
          server-id: github
          settings-path: ${{ github.workspace }}

      - name: CosId-ShardingSphere
        run: gradle cosid-shardingsphere:clean cosid-shardingsphere:jmh

  cosid-redis-benchmark:
    name: CosId Redis Benchmark
    runs-on: ubuntu-latest
    services:
      redis:
        image: redis
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 6379:6379
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: Set up JDK 8
        uses: actions/setup-java@v2
        with:
          java-version: '8'
          distribution: 'adopt'
          server-id: github
          settings-path: ${{ github.workspace }}

      - name: CosId-Redis
        run: gradle cosid-redis:clean cosid-redis:jmh

  cosid-jdbc-benchmark:
    name: CosId Jdbc Benchmark
    runs-on: ubuntu-latest
    steps:
      - name: Start Mysql
        run:  sudo /etc/init.d/mysql start

      - name: Checkout
        uses: actions/checkout@master

      - name: Set up JDK 8
        uses: actions/setup-java@v2
        with:
          java-version: '8'
          distribution: 'adopt'
          server-id: github
          settings-path: ${{ github.workspace }}

      - name: Init CosId-Db
        run: mysql -vvv -h localhost -uroot -proot < cosid-benchmark/src/jmh/init/init-script.sql

      - name: CosId-Jdbc
        run: gradle cosid-jdbc:clean cosid-jdbc:jmh

